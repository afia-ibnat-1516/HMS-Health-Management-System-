<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <title>Medication History</title>
</head>
<body class="nutrition-body">
    <div class="navbar">
            <div class="icon">
                <h2 class="logo">H.M.S</h2>
            </div>
            <div class="menu">
                <ul>
                    <li><a href="home.html">HOME</a></li>
                    <li><a href="profile.html">PROFILE</a></li>
                    <li><a href="service.html">SERVICES</a></li>
                    <li><a href="contact.html">DOCTOR'S CONTACT</a></li>
                </ul>
            </div>
        </div>
<header class="nutrition-header">
    <h1 class="nutrition-title">Medication History Tracker</h1>
</header>
<main class="nutrition-main">
    <div class="medication-section">
    <form id="medicationHistoryForm">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required>

        <label for="age">Age:</label>
        <input type="number" id="age" name="age" required>

        <label for="gender">Gender:</label>
        <select id="gender" name="gender" required>
            <option value="male">Male</option>
            <option value="female">Female</option>
            <option value="other">Other</option>
        </select>

        <label for="medication">Medication History:</label>
        <textarea id="medication" name="medication" rows="4" required></textarea>

        <label for="dosage">Dosage:</label>
        <input type="text" id="dosage" name="dosage" required>

        <label for="time">Time:</label>
        <input type="time" id="time" name="time" required>

        <label for="date">Date:</label>
        <input type="date" id="date" name="date" required>

        <label for="exercisePerDay">Exercise Timing Per Day:</label>
        <input type="text" id="exercisePerDay" name="exercisePerDay" required>

        <label for="exercisePerWeek">Exercise Timing Per Week:</label>
        <input type="text" id="exercisePerWeek" name="exercisePerWeek" required>

        <button type="button" onclick="submitMedicationHistory()">Submit</button>
    </form>

    <table id="medicationHistoryTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Age</th>
                <th>Gender</th>
                <th>Medication</th>
                <th>Dosage</th>
                <th>Time</th>
                <th>Date</th>
                <th>Exercise Per Day</th>
                <th>Exercise Per Week</th>
                <th>Action</th> 
            </tr>
        </thead>
        <tbody>
            <!-- Medication history records will be added here dynamically -->
        </tbody>
    </table>
</div>
</main>
<script>
function submitMedicationHistory() {
    const data = {
        name: document.getElementById('name').value,
        age: document.getElementById('age').value,
        gender: document.getElementById('gender').value,
        medication: document.getElementById('medication').value,
        dosage: document.getElementById('dosage').value,
        time: document.getElementById('time').value,
        date: document.getElementById('date').value,
        exercisePerDay: document.getElementById('exercisePerDay').value,
        exercisePerWeek: document.getElementById('exercisePerWeek').value
    };

    fetch("/medication/add", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(res => {
        if (res.status === "success") {
            loadMedication();
            document.getElementById("medicationHistoryForm").reset();
        } else {
            alert("Error saving!");
        }
    });
}

function loadMedication() {
    fetch("/medication/list")
    .then(response => response.json())
    .then(records => {
        let tableBody = document
            .getElementById("medicationHistoryTable")
            .getElementsByTagName("tbody")[0];

        tableBody.innerHTML = "";

        records.forEach(r => {
            let row = `
                <tr>
                    <td>${r.name}</td>
                    <td>${r.age}</td>
                    <td>${r.gender}</td>
                    <td>${r.medication}</td>
                    <td>${r.dosage}</td>
                    <td>${r.time_taken}</td>
                    <td>${r.date_taken}</td>
                    <td>${r.exercise_per_day}</td>
                    <td>${r.exercise_per_week}</td>
                    <td>
                        <button onclick="deleteMedication(${r.id})"
                            style="background:#d9534f;color:white;border:none;padding:6px 12px;border-radius:4px;cursor:pointer;">
                            Delete
                        </button>
                    </td>
                </tr>
            `;
            tableBody.innerHTML += row;
        });
    });
}

function deleteMedication(id) {
    if (!confirm("Are you sure you want to delete this record?")) return;

    fetch(`/medication/delete/${id}`, {
        method: "DELETE"
    })
    .then(response => response.json())
    .then(res => {
        if (res.status === "success") {
            loadMedication();
        } else {
            alert("Could not delete!");
        }
    });
}

window.onload = loadMedication;
</script>
</body>
<footer>
    &copy; 2025 H.M.S [Health Management System]. All rights reserved.
</footer>
</html>
